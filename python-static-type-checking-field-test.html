<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Python static type checking: field test - Thibaud’s blog</title>

  <link rel="stylesheet" href="/css/screen.css">

  
  <meta name="description" content="A few years ago, with the release of Pyre from Facebook, I got really excited about the potential of type annotations and type checkers for Python codebases....">
  <meta name="author" content="Thibaud Colas"><link rel="canonical" href="https://thib.me/python-static-type-checking-field-test">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="/atom.xml" rel="alternate" title="Thibaud’s blog" type="application/atom+xml">

  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:url" content="https://thib.me/python-static-type-checking-field-test">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Thibaud’s blog">
  <meta name="twitter:site" content="@thibaud_colas">
  <meta name="twitter:creator" content="@thibaud_colas">
  <meta property="og:title" content="Python static type checking: field test">
  <meta property="og:description" content="A few years ago, with the release of Pyre from Facebook, I got really excited about the potential of type annotations and type checkers for Python codebases....">
  
  <meta name="twitter:label1" value="Reading time">
  <meta name="twitter:data1" value="Not too long">

  <link rel="meta" title="FOAF" type="application/rdf+xml" href="/foaf.rdf">

  
  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-34692999-4','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</head>

<body   >
  <header><hgroup>
  <h1><a href="/">Thibaud’s blog</a></h1>
  
    <h2>Notes, thoughts, and open-source software</h2>
  
</hgroup>

</header>
  <nav>  
<ul class="main-navigation">
  <li><a href="https://twitter.com/thibaud_colas">Twitter</a></li>
  <li><a href="https://github.com/thibaudcolas">GitHub</a></li>
  <li><a href="/resume" data-no-instant>Resume</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div role="main" id="main">
    <div id="content">
      <div class="blog-index">
<article class="hentry">
  
  <header>
    
      <a class="edit-link" aria-label="Edit this page on GitHub" href="https://github.com/thibaudcolas/thibaudcolas/edit/main/src/_posts/2019-12-28-python-static-type-checking-field-test.md">Edit</a>
      <h1 class="entry-title">Python static type checking: field test</h1>
    
    
      <p class="meta">
        









<time datetime="2019-12-28T17:10:26+00:00" pubdate data-updated="true">2019-12-28 17:10</time>
        
      </p>
    
  </header>


<div class="entry-content" data-no-instant><p>A few years ago, with the release of <a href="https://pyre-check.org/">Pyre</a> from Facebook, I got really excited about the potential of type annotations and type checkers for Python codebases. Having spent a lot of time with <a href="https://flow.org/">Flow</a>, also from Facebook, I was full of hope. Now, let’s see how well static type checking actually works in modern Python.</p>

<!-- more -->

<h2 id="tldr">TL;DR;</h2>

<p>After my experiments, I was really hoping I could heartily recommend using type annotations and static type checkers for most projects in most cases. In reality it feels like it’s too early still, unless:</p>

<ul>
  <li>You’re already sold on the idea of static typing, and you already know type systems from other languages – you’ll be able to navigate the messy Python landscape.</li>
  <li>You only work on projects that are kept up-to-date with Python releases – so Python 3.8+ only.</li>
  <li>You maintain large codebases, and have a large enough team to invest into tooling.</li>
</ul>

<p>For the rest of us, who work on teams with varying degrees of knowledge and buy-in about types, in projects that use Python 3.5, with lots of untyped dependencies, and little budget for maintenance – it just feels too early.</p>

<h2 id="type-annotations">Type annotations</h2>

<p>The first thing I learned while investigating static typing more thoroughly was that even though PEP-484, which started it all, was implemented in Python 3.5 – it really was just the beginning, and much more is needed to fully benefit from typing code. Here are all type-related PEPs I looked into using while typing my <a href="https://github.com/springload/draftjs_exporter/issues/101">±4000 SLOC project</a> on which I wanted to try this:</p>

<ul>
  <li><a href="https://www.python.org/dev/peps/pep-3107/">PEP 3107 – Function annotations</a> (Python 3.0)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0484/">PEP 484 – Type annotations for function parameters and return values</a> (Python 3.5)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0526/">PEP 526 – Syntax for Variable Annotations</a> (Python 3.6)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0561/">PEP 561 – Distributing and Packaging Type Information</a> (Python 3.7)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0563/">PEP 563 – Postponed Evaluation of Annotations</a> (Python 3.7)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0586/">PEP 586 – Literal Types</a> (Python 3.8)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0589/">PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a> (Python 3.8)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0544/">PEP 544 – Protocols: Structural subtyping (static duck typing)</a> (Python 3.8)</li>
  <li><a href="https://www.python.org/dev/peps/pep-0591/">PEP 591 – Adding a final qualifier to typing</a> (Python 3.8)</li>
  <li>Not a PEP but also worth mentioning: the <a href="https://pypi.org/classifiers/"><code class="language-plaintext highlighter-rouge">Typing :: Typed</code></a> trove classifier</li>
</ul>

<p>I’m used to leveraging dictionaries with fixed set of keys in other languages (e.g. JSON with a set structure). Literal types are also very useful. So is structural subtyping, especially in a language like Python. Without these available, it felt really strange to write annotations using very broad categories – e.g. <code class="language-plaintext highlighter-rouge">Dict[str, Any]</code> when really the dictionary should only have a few keys for which the types are well-known. Or use <code class="language-plaintext highlighter-rouge">str</code> for a very limited set of literals.</p>

<p>I found the <a href="https://mypy.readthedocs.io/en/latest/index.html">mypy documentation</a> to be the best source of information on what was and wasn’t available in the type system / type checkers. It’s important to note that some of the above are available as backports in <a href="https://github.com/python/typing/tree/master/typing_extensions">typing_extensions</a>, but I felt somewhat funny adding a dependency for my project just for the sole purpose of adding type definitions that are only ever used statically. All in all, if it wasn’t for mypy’s type reference this would have been really hard to navigate. Hopefully this will get easier once Python 3.8+ is more established, and there are more resources available online dedicated to static typing in Python.</p>

<h2 id="type-checkers">Type checkers</h2>

<p>On the topic of type checkers, here are the ones I tried:</p>

<ul>
  <li><a href="https://github.com/google/pytype">pytype</a> from Google.</li>
  <li><a href="https://github.com/Microsoft/pyright">pyright</a> from Microsoft.</li>
  <li><a href="https://pyre-check.org/">Pyre</a> from Facebook.</li>
  <li><a href="https://github.com/python/mypy">mypy</a> from Dropbox (and more).</li>
</ul>

<p>Out of these four, mypy is by far the most established, having been around the longest, and having the best documentation. Even though I liked Flow from Facebook, Pyre still feels very experimental and poorly documented – as far as I could remember the official docs are the exact same as they were when I checked it out a year ago, and I couldn’t get it to understand type aliases. I also had similar documentation issues with pytype – I could get it working, but couldn’t get it to read my project’s stubs. Finally, pyright gets an honorable mention. Its README clearly states that it’s only a side project (and has been created only a few months ago), but it was very straightforward to set up and get meaningful results with.</p>

<p>I would recommend using mypy for people starting with static typing in Python – it’s the easiest to use as of now, has the <a href="https://mypy.readthedocs.io/en/latest/">best documentation</a> by far, and seems like it has a bright future ahead of itself. It even has a <a href="https://mypy.readthedocs.io/en/latest/mypy_daemon.html">daemon/server mode</a> to get better performance for large codebases.</p>

<h2 id="starting-to-use-types-on-a-project">Starting to use types on a project</h2>

<p>Here is the process I would recommend, for small projects where the whole codebase can be typed in one go:</p>

<ol>
  <li>Research whether types are suitable on your project – do you have major dependencies that might be untyped and hard to stub? Are there JSON-like data structures that will need special attention to be typed correctly?</li>
  <li>Set up mypy with the most permissive settings possible. We can turn on the strictness later.</li>
  <li>Consider using a tool like <a href="https://github.com/dropbox/pyannotate">pyannotate</a> (also from Dropbox) to automatically add annotations to your code.</li>
  <li>Start manually annotating internal modules that have straightforward signatures (e.g. utility code, or basic data processing, without external dependencies)</li>
  <li>Expand annotations to reach your public API.</li>
  <li>Turn on stricter mypy settings.</li>
</ol>

<h2 id="resources">Resources</h2>

<p>Here are resources I would also recommend checking out:</p>

<ul>
  <li><a href="https://realpython.com/python-type-checking/">https://realpython.com/python-type-checking/</a>, the best all-in-one resource that is not mypy’s type system reference.</li>
  <li><a href="https://github.com/typeddjango/awesome-python-typing">https://github.com/typeddjango/awesome-python-typing</a>, a list of resources on typing in Python.</li>
  <li><a href="https://github.com/psf/black/blob/master/black.py">https://github.com/psf/black/blob/master/black.py</a>, a real-world codebase that uses type annotations.</li>
  <li><a href="https://github.com/JelleZijlstra/lxml-stubs">https://github.com/JelleZijlstra/lxml-stubs</a>, an example of type stubs outside of typeshed.</li>
  <li><a href="https://www.destroyallsoftware.com/talks/ideology">https://www.destroyallsoftware.com/talks/ideology</a>, an inslightful talk from Gary Bernhardt about types, unit tests, and ideology.</li>
</ul>
</div>



  <footer>
    <p class="meta">
      
<span class="byline author vcard">By <span class="fn">Thibaud Colas</span></span>

      









<time datetime="2019-12-28T17:10:26+00:00" pubdate data-updated="true">2019-12-28 17:10</time>
      

<span class="categories">
  
    
      <a class="category" href="/categories/python/">Python</a>,
    
      <a class="category" href="/categories/tools/">Tools</a>,
    
      <a class="category" href="/categories/code/">Code</a>
    
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/testing-with-multiple-versions-of-npm-packages" title="Previous Post: Testing with multiple versions of npm packages">&laquo; Testing with multiple versions of npm packages</a>
      
      
        <a class="basic-alignment right" href="/upgrading-to-stricter-eslint-config" title="Next Post: Upgrading to a stricter ESLint config">Upgrading to a stricter ESLint config &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/estimating-wagtail-websites-emissions">Estimating Wagtail websites’ emissions</a>
      </li>
    
      <li class="post">
        <a href="/google-season-of-docs-creating-wagtail-developer-onboarding-tutorials">Google Season of Docs: Creating Wagtail Developer Onboarding Tutorials</a>
      </li>
    
      <li class="post">
        <a href="/evaluating-carbon-footprint-django-wagtail">Evaluating the carbon footprint of Django and Wagtail - Django London</a>
      </li>
    
      <li class="post">
        <a href="/wagtails-new-developer-relations-team">Wagtail’s new Developer Relations team</a>
      </li>
    
      <li class="post">
        <a href="/wagtail-cms-projects-for-google-summer-of-code-2023">Wagtail CMS projects for Google Summer of Code 2023</a>
      </li>
    
  </ul>
</section>

  
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos" data-user="thibaudcolas" data-count="5">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/thibaudcolas">@thibaudcolas</a> on GitHub
  
  <script src="/javascripts/github.js"></script>
</section>


</aside>


    </div>
  </div>
  <footer><p>
  By <a href="" rel="author">Thibaud Colas</a> -
  Content available under <a class="license" rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a> -
  <span class="credit">Hosted on <a href="https://pages.github.com/">GitHub Pages</a></span> -
  <a class="fork-link" href="https://github.com/thibaudcolas/thibaudcolas">View source</a>
</p>

</footer>
  

<script src="/javascripts/libs/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init(50);</script>


</body>
</html>
